/*! cStorage  0.2.2 2015-10-21 */
function cStorage(b,a){if(!b){throw new Error("missing function params");return false}else{this._dbname=b;this._data=_helper.getStorage(this._dbname);this._foundParent=this.root(a)._foundParent;this._foundChild=false;this._isFound=false;return this}}cStorage.prototype.save=function(b,a,c){if(!b||typeof b!=="object"){b=this._data}if(c==undefined){c=true}if(a){_helper.loop(b,function(d,e){return _helper.encode(d[e])},null,null,null,c)}this._data=this._foundParent=b;this._isFound=false;window.localStorage.setItem(this._dbname,this.toString());return this};cStorage.prototype.root=function(a){this._isFound=false;if(!a){this._foundParent=this._data}else{var b=_helper.getRootObjFromString(this._data,a);if(b){this._foundParent=b;this._isFound=true}}return this};cStorage.prototype.find=function(g,f){if(!g){return false}if(f==undefined){f=true}var d,e;if(typeof g==="string"||typeof g==="number"){e=d=g}else{for(var b in g){d=b;e=g[b]}}var a=this._foundParent;var c=this;c._isFound=false;return _helper.loop(a,null,{key:d,value:e},function(h,i){c._foundParent=h;c._foundChild=i;c._isFound=true;return c},c,f)};cStorage.prototype.get=function(a,c,d){var b=this._foundParent;if(a){b=_helper.getRootObjFromString(this._data,a)}if(c){if(d==undefined){d=true}_helper.loop(b,function(e,f){return _helper.decode(e[f])},null,null,null,d)}return b};cStorage.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))};cStorage.prototype.edit=function(c){if(Object.prototype.toString.call(this._foundParent)==="[object Array]"){return this}if(!c){return this}var b,b;for(var a in c){b=a||"";findValue=c[a]||"";if(b){this._foundParent[b]=findValue}}this.save();return this};cStorage.prototype.add=function(d){if(!d){return this}var a=this._foundParent;var c=this;var e=function(h,j){if(Object.prototype.toString.call(h)==="[object Object]"){var g,g;for(var f in j){g=f||"";findValue=j[f]||"";if(g){h[g]=findValue}}}else{if(Object.prototype.toString.call(h)==="[object Array]"){h.push(j)}}};if(Object.prototype.toString.call(d)==="[object Array]"){for(var b in d){e(a,d[b])}}else{e(a,d)}this.save();return this};cStorage.prototype.map=function(b,a){if(!b&&typeof b!=="function"){throw new Error("missing function params");return false}if(a==undefined){a=true}return _helper.loop(this._foundParent,b,null,null,this,a)};cStorage.prototype.getValue=function(a){if(a){return _helper.decode(this._foundChild)}else{return this._foundChild}};cStorage.prototype.getUid=function(c,d){if(!c){throw new Error("missing function params");return false}var a=this._foundParent;if(d==undefined){d=true}var b=false;var f=function(g){if(!b){b=g}else{if(b<g){b=g}}};var e=function(g,h,i){if(c==h){f(i)}};_helper.loop(a,e,null,null,null,d);if(!b){b=0}return parseInt(b)+1};cStorage.prototype.toString=function(a,b,c){return JSON.stringify(this.get(a,b,c))};cStorage.prototype.isEmpty=function(){var a=this._foundParent;if(JSON.stringify(a).replace(/[{}\[\]]/g,"")==""){return true}else{return false}};cStorage.prototype.isFound=function(){return this._isFound};var _helper={getStorage:function(a){var b=window.localStorage.getItem(a)||"{}";var d={};try{d=JSON.parse(b);if(typeof d==="object"){return d}return{}}catch(c){throw new Error("non well formed json string");return{}}},encode:function(a){if(a&&typeof a==="string"){return encodeURIComponent(a)}return a},decode:function(a){if(a&&typeof a==="string"){return decodeURIComponent(a.replace(/\+/g," "))}return a},getRootObjFromString:function(c,a){if(!c){return false}var d=c;if(a){a=a.split(".");for(var b in a){d=d[a[b]]}}return d},loop:function(g,b,d,j,f,h){var a;if(Object.prototype.toString.call(g)==="[object Object]"){a="object"}else{if(Object.prototype.toString.call(g)==="[object Array]"){a="array"}else{return false}}for(var c in g){if(g.hasOwnProperty(c)){if(b){var e=b(g,c,g[c]);if(e){g[c]=e}}if(typeof g[c]==="object"){if(h){var i=_helper.loop(g[c],b,d,j,null,h);if(i){return i}}}if(j){if(a=="object"){if(d.key&&d.value&&c==d.key&&g[c]==d.value){return j(g,g[c])}}else{if(a=="array"){if(d.value&&g[c]==d.value){return j(g,g[c])}}}}}}if(f){return f}else{return false}}};
