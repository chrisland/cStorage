/* cStorage 0.2.11 */
!function(t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else{if("function"==typeof define&&define.amd)return define([],t);(this||window).cStorage=t()}}(function(){"use strict";function t(n,e){if(!(this instanceof t))return new t(n,e);if(n)return this._dbname=n,this._data=o.getStorage(this._dbname),this._foundParent=this.root(e)._foundParent,this._foundChild=!1,this._foundPath=[],this._foundKey=!1,this._isFound=!1,this;throw new Error("missing function params")}t.prototype.save=function(t,n,e){return t&&"object"==typeof t||(t=this._data),void 0==e&&(e=!0),n&&o.loop(t,function(t,n){return o.encode(t[n])},e),this._data=this._foundParent=t,this._isFound=!1,window.localStorage.setItem(this._dbname,this.toString()),this},t.prototype.root=function(t){if(this._foundParent=this._data,this._foundKey=!1,this._foundChild=!1,this._foundPath=[],this._isFound=!1,t){var n=o.getRootObjFromString(this._data,t);n&&(this._foundParent=n,this._foundPath=t.split("."),this._isFound=!0)}return this},t.prototype.child=function(t,n){if(!t)return!1;void 0==n&&(n=!0),this._foundKey=!1,this._foundChild=!1,this._isFound=!1;var e=o.getRootObjFromString(this._foundParent,t);return e&&(this._foundParent=e,this._foundPath=this._foundPath.concat(t.split(".")),this._isFound=!0),this},t.prototype.find=function(t,n){if(!t)return!1;void 0==n&&(n=!0);var e,r;if("string"==typeof t||"number"==typeof t)r=e=t;else for(var i in t)e=i,r=t[i];var s=this._foundParent;this._foundParent=!1,this._foundKey=!1,this._foundChild=!1,this._isFound=!1;var f=o.find(s,{key:e,value:r},n);return f&&(this._foundParent=f[1],this._foundKey=f[2],this._foundChild=f[3],this._foundPath=this._foundPath.concat(f[4]),this._isFound=!0,this._indexOf=f[5]),this},t.prototype.get=function(t,n,e){var r=this._foundParent;return t&&(r=o.getRootObjFromString(this._data,t)),n&&(void 0==e&&(e=!0),o.loop(r,function(t,n){return o.decode(t[n])},e)),r},t.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))},t.prototype.edit=function(t){if("[object Array]"===Object.prototype.toString.call(this._foundParent))return this;if(!t)return this;var o=!1,n=!1;for(var e in t)o=e||"",n=t[e]||"",o&&(this._foundParent[o]=n);return this.save(),this},t.prototype.add=function(t,n,e){if(!t)return this;e||(e=!0);var r=this._foundParent;n&&o.loop(t,function(t,n){return o.encode(t[n])},e);var i=function(t,o){if("[object Object]"===Object.prototype.toString.call(t)){var n=!1,e=!1;for(var r in o)n=r||"",e=o[r]||"",n&&(t[n]=e)}else"[object Array]"===Object.prototype.toString.call(t)&&t.push(o)};if("[object Array]"===Object.prototype.toString.call(t))for(var s in t)i(r,t[s]);else i(r,t);return this.save(),this},t.prototype.remove=function(){if((!this._foundPath||this._foundPath.length<1)&&!this._foundParent)return!1;var t=JSON.parse(JSON.stringify(this._foundPath)),n=t.pop();t=t.join(".");var e=o.getRootObjFromString(this._data,t);return!!e&&("[object Array]"===Object.prototype.toString.call(e)?(e.splice(n,1),this.save()):"[object Object]"===Object.prototype.toString.call(e)&&(delete e[n],this.save()),this)},t.prototype.map=function(t,n,e){if(!t&&"function"!=typeof t)throw new Error("missing function params");return void 0==n&&(n=!0),o.loop(this._foundParent,t,n,e),this},t.prototype.getValue=function(t){return t?o.decode(this._foundChild):this._foundChild},t.prototype.getUid=function(t,n){if(!t)throw new Error("missing function params");var e=this._foundParent;void 0==n&&(n=!0);var r=!1,i=function(t){r?r<t&&(r=parseInt(t)):r=parseInt(t)};return o.loop(e,function(o,n,e){t==n&&i(e)},n),r&&!isNaN(r)||(r=0),parseInt(r)+1},t.prototype.toString=function(t,o,n){return JSON.stringify(this.get(t,o,n))},t.prototype.isEmpty=function(){var t=this._foundParent;return""==JSON.stringify(t).replace(/[{}\[\]]/g,"")},t.prototype.isFound=function(){return this._isFound},t.prototype.indexOf=function(){return!(!this._isFound||void 0===this._indexOf||isNaN(this._indexOf))&&this._indexOf};var o={getStorage:function(t){var o=window.localStorage.getItem(t)||"{}",n={};try{return n=JSON.parse(o),"object"==typeof n?n:{}}catch(t){throw new Error("non well formed json string")}},encode:function(t){return t&&"string"==typeof t?encodeURIComponent(t):t},decode:function(t){return t&&"string"==typeof t?decodeURIComponent(t.replace(/\+/g," ")):t},getRootObjFromString:function(t,o){if(!t)return!1;var n=t;if(o){o=o.split(".");for(var e in o)n=n[o[e]]}return n},find:function(t,n,e,r,i,s){!0===e&&(e=999),void 0==i?i=0:i++;var f;if("[object Object]"===Object.prototype.toString.call(t))f="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;f="array"}var u=r||[],s=s||0;for(var a in t)if(t.hasOwnProperty(a)){if("object"==f){if(n.key&&n.value&&a==n.key&&t[a]==n.value)return[!0,t,a,t[a],u,s]}else if("array"==f&&n.key==n.value&&n.value&&t[a]==n.value)return[!0,t,a,t[a],u,s];if("object"==typeof t[a]&&e&&e>=i){"object"==typeof t[a][0]&&(s=0);var d=o.find(t[a],n,e,u,i,s);if(d&&d[0])return u.unshift(a),[!0,d[1],d[2],d[3],d[4],d[5]]}s++}return!1},loop:function(t,n,e,r){if("[object Object]"===Object.prototype.toString.call(t))"object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;"array"}for(var i in t)if(t.hasOwnProperty(i)){if(n){r&&o.loop(t[i],function(t,n){return o.decode(t[n])},e);var s=n(t,i,t[i]);s&&(t[i]=s)}"object"==typeof t[i]&&e&&o.loop(t[i],n,e,r)}return!1}};return t});