/* cStorage 0.2.12 */
!function(t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else{if("function"==typeof define&&define.amd)return define([],t);(this||window).cStorage=t()}}(function(){"use strict";function t(n,i){if(!(this instanceof t))return new t(n,i);if(n)return this._dbname=n,this._data=o.getStorage(this._dbname),this._foundParent=this.root(i)._foundParent,this._foundChild=!1,this._foundPath=[],this._foundKey=!1,this._isFound=!1,this._indexOf=!1,this;throw new Error("missing function params")}t.prototype.save=function(t,n,i){return t&&"object"==typeof t||(t=this._data),void 0==i&&(i=!0),n&&o.loop(t,function(t,n){return o.encode(t[n])},i),this._data=this._foundParent=t,this._isFound=!1,this._indexOf=!1,window.localStorage.setItem(this._dbname,this.toString()),this},t.prototype.root=function(t){if(this._foundParent=this._data,this._foundKey=!1,this._foundChild=!1,this._foundPath=[],this._isFound=!1,this._indexOf=!1,t){var n=o.getRootObjFromString(this._data,t);n&&(this._foundParent=n,this._foundPath=t.split("."),this._isFound=!0,this._foundKey=t)}return this},t.prototype.child=function(t,n){if(!t)return!1;void 0==n&&(n=!0),this._foundKey=!1,this._foundChild=!1,this._isFound=!1,this._indexOf=!1;var i=o.getRootObjFromString(this._foundParent,t);return i&&(this._foundParent=i,this._foundPath=this._foundPath.concat(t.split(".")),this._isFound=!0),this},t.prototype.find=function(t,n){if(!t)return!1;void 0==n&&(n=!0);var i,e;if("string"==typeof t||"number"==typeof t)e=i=t;else for(var r in t)i=r,e=t[r];var s=this._foundParent;this._foundParent=!1,this._foundKey=!1,this._foundChild=!1,this._isFound=!1,this._indexOf=!1;var f=o.find(s,{key:i,value:e},n);return f&&(this._foundParent=f[1],this._foundKey=f[2],this._foundChild=f[3],this._foundPath=this._foundPath.concat(f[4]),this._isFound=!0,this._indexOf=f[5]),this},t.prototype.get=function(t,n,i){var e=this._foundParent;return t&&(e=o.getRootObjFromString(this._data,t)),n&&(void 0==i&&(i=!0),o.loop(e,function(t,n){return o.decode(t[n])},i)),e},t.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))},t.prototype.edit=function(t){if("[object Array]"===Object.prototype.toString.call(this._foundParent))return this;if(!t)return this;var o=!1,n=!1;for(var i in t)o=i||"",n=t[i]||"",o&&(this._foundParent[o]=n);return this.save(),this},t.prototype.duplicate=function(t){if(!this._foundPath||!this._foundParent)return this;var n=this._foundPath.shift(),i=o.getRootObjFromString(this._data,n);if(i&&"[object Array]"===Object.prototype.toString.call(i)){var e=JSON.parse(JSON.stringify(this._foundParent));if(e){if(t)for(var r in t)e[r]=t[r];i.splice(this._indexOf+1,0,e)}}return this},t.prototype.add=function(t,n,i){if(!t)return this;i||(i=!0);var e=this._foundParent;n&&o.loop(t,function(t,n){return o.encode(t[n])},i);var r=function(t,o){if("[object Object]"===Object.prototype.toString.call(t)){var n=!1,i=!1;for(var e in o)n=e||"",i=o[e]||"",n&&(t[n]=i)}else"[object Array]"===Object.prototype.toString.call(t)&&t.push(o)};if("[object Array]"===Object.prototype.toString.call(t))for(var s in t)r(e,t[s]);else r(e,t);return this.save(),this},t.prototype.remove=function(){if((!this._foundPath||this._foundPath.length<1)&&!this._foundParent)return!1;var t=JSON.parse(JSON.stringify(this._foundPath)),n=t.pop();t=t.join(".");var i=o.getRootObjFromString(this._data,t);return!!i&&("[object Array]"===Object.prototype.toString.call(i)?(i.splice(n,1),this.save()):"[object Object]"===Object.prototype.toString.call(i)&&(delete i[n],this.save()),this)},t.prototype.map=function(t,n,i){if(!t&&"function"!=typeof t)throw new Error("missing function params");return void 0==n&&(n=!0),o.loop(this._foundParent,t,n,i),this},t.prototype.getValue=function(t){return t?o.decode(this._foundChild):this._foundChild},t.prototype.getUid=function(t,n){if(!t)throw new Error("missing function params");var i=this._foundParent;void 0==n&&(n=!0);var e=!1,r=function(t){e?e<t&&(e=parseInt(t)):e=parseInt(t)};return o.loop(i,function(o,n,i){t==n&&r(i)},n),e&&!isNaN(e)||(e=0),parseInt(e)+1},t.prototype.toString=function(t,o,n){return JSON.stringify(this.get(t,o,n))},t.prototype.isEmpty=function(){var t=this._foundParent;return""==JSON.stringify(t).replace(/[{}\[\]]/g,"")},t.prototype.isFound=function(){return this._isFound},t.prototype.indexOf=function(){return!(!this._isFound||void 0===this._indexOf||isNaN(this._indexOf))&&this._indexOf};var o={getStorage:function(t){var o=window.localStorage.getItem(t)||"{}",n={};try{return n=JSON.parse(o),"object"==typeof n?n:{}}catch(t){throw new Error("non well formed json string")}},encode:function(t){return t&&"string"==typeof t?encodeURIComponent(t):t},decode:function(t){return t&&"string"==typeof t?decodeURIComponent(t.replace(/\+/g," ")):t},getRootObjFromString:function(t,o){if(!t)return!1;var n=t;if(o){o=o.split(".");for(var i in o)n=n[o[i]]}return n},find:function(t,n,i,e,r,s){!0===i&&(i=999),void 0==r?r=0:r++;var f;if("[object Object]"===Object.prototype.toString.call(t))f="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;f="array"}var a=e||[],s=s||0;for(var u in t)if(t.hasOwnProperty(u)){if("object"==f){if(n.key&&n.value&&u==n.key&&t[u]==n.value)return[!0,t,u,t[u],a,s]}else if("array"==f&&n.key==n.value&&n.value&&t[u]==n.value)return[!0,t,u,t[u],a,s];if("object"==typeof t[u]&&i&&i>=r){"object"==typeof t[u][0]&&(s=0);var h=o.find(t[u],n,i,a,r,s);if(h&&h[0])return a.unshift(u),[!0,h[1],h[2],h[3],h[4],h[5]]}s++}return!1},loop:function(t,n,i,e){if("[object Object]"===Object.prototype.toString.call(t))"object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;"array"}for(var r in t)if(t.hasOwnProperty(r)){if(n){e&&o.loop(t[r],function(t,n){return o.decode(t[n])},i);var s=n(t,r,t[r]);s&&(t[r]=s)}"object"==typeof t[r]&&i&&o.loop(t[r],n,i,e)}return!1}};return t});