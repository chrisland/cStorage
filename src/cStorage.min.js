/* cStorage 0.2.7 */
!function(t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else{if("function"==typeof define&&define.amd)return define([],t);(this||window).cStorage=t()}}(function(){"use strict";function t(n,r){if(!(this instanceof t))return new t(n,r);if(n)return this._dbname=n,this._data=o.getStorage(this._dbname),this._foundParent=this.root(r)._foundParent,this._foundChild=!1,this._foundPath=[],this._foundKey=!1,this._isFound=!1,this;throw new Error("missing function params")}t.prototype.save=function(t,n,r){return t&&"object"==typeof t||(t=this._data),void 0==r&&(r=!0),n&&o.loop(t,function(t,n){return o.encode(t[n])},r),this._data=this._foundParent=t,this._isFound=!1,window.localStorage.setItem(this._dbname,this.toString()),this},t.prototype.root=function(t){if(this._foundParent=this._data,this._foundKey=!1,this._foundChild=!1,this._foundPath=[],this._isFound=!1,t){var n=o.getRootObjFromString(this._data,t);n&&(this._foundParent=n,this._foundPath=t.split("."),this._isFound=!0)}return this},t.prototype.child=function(t,n){if(!t)return!1;void 0==n&&(n=!0),this._foundKey=!1,this._foundChild=!1,this._isFound=!1;var r=o.getRootObjFromString(this._foundParent,t);return r&&(this._foundParent=r,this._foundPath=this._foundPath.concat(t.split(".")),this._isFound=!0),this},t.prototype.find=function(t,n){if(!t)return!1;void 0==n&&(n=!0);var r,e;if("string"==typeof t||"number"==typeof t)e=r=t;else for(var i in t)r=i,e=t[i];var s=this._foundParent;this._foundParent=!1,this._foundKey=!1,this._foundChild=!1,this._isFound=!1;var a=o.find(s,{key:r,value:e},n);return a&&(this._foundParent=a[1],this._foundKey=a[2],this._foundChild=a[3],this._foundPath=this._foundPath.concat(a[4]),this._isFound=!0),this},t.prototype.get=function(t,n,r){var e=this._foundParent;return t&&(e=o.getRootObjFromString(this._data,t)),n&&(void 0==r&&(r=!0),o.loop(e,function(t,n){return o.decode(t[n])},r)),e},t.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))},t.prototype.edit=function(t){if("[object Array]"===Object.prototype.toString.call(this._foundParent))return this;if(!t)return this;var o=!1,n=!1;for(var r in t)o=r||"",n=t[r]||"",o&&(this._foundParent[o]=n);return this.save(),this},t.prototype.add=function(t,n,r){if(!t)return this;r||(r=!0);var e=this._foundParent;n&&o.loop(t,function(t,n){return o.encode(t[n])},r);var i=function(t,o){if("[object Object]"===Object.prototype.toString.call(t)){var n=!1,r=!1;for(var e in o)n=e||"",r=o[e]||"",n&&(t[n]=r)}else"[object Array]"===Object.prototype.toString.call(t)&&t.push(o)};if("[object Array]"===Object.prototype.toString.call(t))for(var s in t)i(e,t[s]);else i(e,t);return this.save(),this},t.prototype.remove=function(){if((!this._foundPath||this._foundPath.length<1)&&!this._foundParent)return!1;var t=JSON.parse(JSON.stringify(this._foundPath)),n=t.pop();t=t.join(".");var r=o.getRootObjFromString(this._data,t);return r?("[object Array]"===Object.prototype.toString.call(r)?(r.splice(n,1),this.save()):"[object Object]"===Object.prototype.toString.call(r)&&(delete r[n],this.save()),this):!1},t.prototype.map=function(t,n){if(!t&&"function"!=typeof t)throw new Error("missing function params");return void 0==n&&(n=!0),o.loop(this._foundParent,t,n),this},t.prototype.getValue=function(t){return t?o.decode(this._foundChild):this._foundChild},t.prototype.getUid=function(t,n){if(!t)throw new Error("missing function params");var r=this._foundParent;void 0==n&&(n=!0);var e=!1,i=function(t){e?t>e&&(e=parseInt(t)):e=parseInt(t)},s=function(o,n,r){t==n&&i(r)};return o.loop(r,s,n),e&&!isNaN(e)||(e=0),parseInt(e)+1},t.prototype.toString=function(t,o,n){return JSON.stringify(this.get(t,o,n))},t.prototype.isEmpty=function(){var t=this._foundParent;return""==JSON.stringify(t).replace(/[{}\[\]]/g,"")},t.prototype.isFound=function(){return this._isFound};var o={getStorage:function(t){var o=window.localStorage.getItem(t)||"{}",n={};try{return n=JSON.parse(o),"object"==typeof n?n:{}}catch(r){throw new Error("non well formed json string")}},encode:function(t){return t&&"string"==typeof t?encodeURIComponent(t):t},decode:function(t){return t&&"string"==typeof t?decodeURIComponent(t.replace(/\+/g," ")):t},getRootObjFromString:function(t,o){if(!t)return!1;var n=t;if(o){o=o.split(".");for(var r in o)n=n[o[r]]}return n},find:function(t,n,r,e){var i;if("[object Object]"===Object.prototype.toString.call(t))i="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;i="array"}var s=e||[];for(var a in t)if(t.hasOwnProperty(a)){if("object"==i){if(n.key&&n.value&&a==n.key&&t[a]==n.value)return[!0,t,a,t[a],s]}else if("array"==i&&n.value&&t[a]==n.value)return[!0,t,a,t[a],s];if("object"==typeof t[a]&&r){var f=o.find(t[a],n,r,s);if(f&&f[0])return s.unshift(a),[!0,f[1],f[2],f[3],f[4]]}}return!1},loop:function(t,n,r){var e;if("[object Object]"===Object.prototype.toString.call(t))e="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;e="array"}for(var i in t)if(t.hasOwnProperty(i)){if(n){var s=n(t,i,t[i]);s&&(t[i]=s)}"object"==typeof t[i]&&r&&o.loop(t[i],n,r)}return!1}};return t});
