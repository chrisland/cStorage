/* cStorage 0.2.5 */
function cStorage(t,r){if(t)return this._dbname=t,this._data=_helper.getStorage(this._dbname),this._foundParent=this.root(r)._foundParent,this._foundChild=!1,this._foundPath=[],this._foundKey=!1,this._isFound=!1,this;throw new Error("missing function params")}cStorage.prototype.save=function(t,r,e){return t&&"object"==typeof t||(t=this._data),void 0==e&&(e=!0),r&&_helper.loop(t,function(t,r){return _helper.encode(t[r])},e),this._data=this._foundParent=t,this._isFound=!1,window.localStorage.setItem(this._dbname,this.toString()),this},cStorage.prototype.root=function(t){if(this._foundParent=this._data,this._foundKey=!1,this._foundChild=!1,this._foundPath=[],this._isFound=!1,t){var r=_helper.getRootObjFromString(this._data,t);r&&(this._foundParent=r,this._foundPath=t.split("."),this._isFound=!0)}return this},cStorage.prototype.find=function(t,r){if(!t)return!1;void 0==r&&(r=!0);var e,o;if("string"==typeof t||"number"==typeof t)o=e=t;else for(var n in t)e=n,o=t[n];var i=this._foundParent;this._foundParent=!1,this._foundKey=!1,this._foundChild=!1,this._isFound=!1;var a=_helper.find(i,{key:e,value:o},r);return a&&(this._foundParent=a[1],this._foundKey=a[2],this._foundChild=a[3],this._foundPath=this._foundPath.concat(a[4]),this._isFound=!0),this},cStorage.prototype.get=function(t,r,e){var o=this._foundParent;return t&&(o=_helper.getRootObjFromString(this._data,t)),r&&(void 0==e&&(e=!0),_helper.loop(o,function(t,r){return _helper.decode(t[r])},e)),o},cStorage.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))},cStorage.prototype.edit=function(t){if("[object Array]"===Object.prototype.toString.call(this._foundParent))return this;if(!t)return this;var r,r;for(var e in t)r=e||"",findValue=t[e]||"",r&&(this._foundParent[r]=findValue);return this.save(),this},cStorage.prototype.add=function(t){if(!t)return this;var r=this._foundParent,e=function(t,r){if("[object Object]"===Object.prototype.toString.call(t)){var e,e;for(var o in r)e=o||"",findValue=r[o]||"",e&&(t[e]=findValue)}else"[object Array]"===Object.prototype.toString.call(t)&&t.push(r)};if("[object Array]"===Object.prototype.toString.call(t))for(var o in t)e(r,t[o]);else e(r,t);return this.save(),this},cStorage.prototype.remove=function(){if((!this._foundPath||this._foundPath.length<1)&&!this._foundParent)return!1;var t=JSON.parse(JSON.stringify(this._foundPath)),r=t.pop();t=t.join(".");var e=_helper.getRootObjFromString(this._data,t);return e?("[object Array]"===Object.prototype.toString.call(e)?(e.splice(r,1),this.save()):"[object Object]"===Object.prototype.toString.call(e)&&(delete e[r],this.save()),this):!1},cStorage.prototype.map=function(t,r){if(!t&&"function"!=typeof t)throw new Error("missing function params");return void 0==r&&(r=!0),_helper.loop(this._foundParent,t,r),this},cStorage.prototype.getValue=function(t){return t?_helper.decode(this._foundChild):this._foundChild},cStorage.prototype.getUid=function(t,r){if(!t)throw new Error("missing function params");var e=this._foundParent;void 0==r&&(r=!0);var o=!1,n=function(t){o?t>o&&(o=parseInt(t)):o=parseInt(t)},i=function(r,e,o){t==e&&n(o)};return _helper.loop(e,i,r),(!o||isNaN(o))&&(o=0),parseInt(o)+1},cStorage.prototype.toString=function(t,r,e){return JSON.stringify(this.get(t,r,e))},cStorage.prototype.isEmpty=function(){var t=this._foundParent;return""==JSON.stringify(t).replace(/[{}\[\]]/g,"")?!0:!1},cStorage.prototype.isFound=function(){return this._isFound};var _helper={getStorage:function(t){var r=window.localStorage.getItem(t)||"{}",e={};try{return e=JSON.parse(r),"object"==typeof e?e:{}}catch(o){throw new Error("non well formed json string")}},encode:function(t){return t&&"string"==typeof t?encodeURIComponent(t):t},decode:function(t){return t&&"string"==typeof t?decodeURIComponent(t.replace(/\+/g," ")):t},getRootObjFromString:function(t,r){if(!t)return!1;var e=t;if(r){r=r.split(".");for(var o in r)e=e[r[o]]}return e},find:function(t,r,e,o){var n;if("[object Object]"===Object.prototype.toString.call(t))n="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;n="array"}var i=o||[];for(var a in t)if(t.hasOwnProperty(a)){if("object"==n){if(r.key&&r.value&&a==r.key&&t[a]==r.value)return[!0,t,a,t[a],i]}else if("array"==n&&r.value&&t[a]==r.value)return[!0,t,a,t[a],i];if("object"==typeof t[a]&&e){var s=_helper.find(t[a],r,e,i);if(s&&s[0])return i.unshift(a),[!0,s[1],s[2],s[3],s[4]]}}},loop:function(t,r,e){var o;if("[object Object]"===Object.prototype.toString.call(t))o="object";else{if("[object Array]"!==Object.prototype.toString.call(t))return!1;o="array"}for(var n in t)if(t.hasOwnProperty(n)){if(r){var i=r(t,n,t[n]);i&&(t[n]=i)}"object"==typeof t[n]&&e&&_helper.loop(t[n],r,e)}return!1}};
