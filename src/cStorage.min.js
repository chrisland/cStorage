/*! cStorage  0.2.1 2015-10-17 */
function cStorage(a,b){if(a)return this._dbname=a,this._data=_helper.getStorage(this._dbname),this._foundParent=this.root(b)._foundParent,this._foundChild=!1,this._isFound=!1,this;throw new Error("missing function params")}cStorage.prototype.save=function(a,b,c){return a&&"object"==typeof a||(a=this._data),void 0==c&&(c=!0),b&&_helper.loop(a,function(a,b){return _helper.encode(a[b])},null,null,null,c),this._data=this._foundParent=a,this._isFound=!1,window.localStorage.setItem(this._dbname,this.toString()),this},cStorage.prototype.root=function(a){if(this._isFound=!1,a){var b=_helper.getRootObjFromString(this._data,a);b&&(this._foundParent=b,this._isFound=!0)}else this._foundParent=this._data;return this},cStorage.prototype.find=function(a,b){if(!a)return!1;void 0==b&&(b=!0);var c,d;if("string"==typeof a||"number"==typeof a)d=c=a;else for(var e in a)c=e,d=a[e];var f=this._foundParent,g=this;return g._isFound=!1,_helper.loop(f,null,{key:c,value:d},function(a,b){return g._foundParent=a,g._foundChild=b,g._isFound=!0,g},g,b)},cStorage.prototype.get=function(a,b,c){var d=this._foundParent;return a&&(d=_helper.getRootObjFromString(this._data,a)),b&&(void 0==c&&(c=!0),_helper.loop(d,function(a,b){return _helper.decode(a[b])},null,null,null,c)),d},cStorage.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))},cStorage.prototype.edit=function(a){if("[object Array]"===Object.prototype.toString.call(this._foundParent))return this;if(!a)return this;var b,b;for(var c in a)b=c||"",findValue=a[c]||"",b&&(this._foundParent[b]=findValue);return this.save(),this},cStorage.prototype.add=function(a){if(!a)return this;var b=this._foundParent,c=function(a,b){if("[object Object]"===Object.prototype.toString.call(a)){var c,c;for(var d in b)c=d||"",findValue=b[d]||"",c&&(a[c]=findValue)}else"[object Array]"===Object.prototype.toString.call(a)&&a.push(b)};if("[object Array]"===Object.prototype.toString.call(a))for(var d in a)c(b,a[d]);else c(b,a);return this.save(),this},cStorage.prototype.map=function(a,b){if(!a&&"function"!=typeof a)throw new Error("missing function params");return void 0==b&&(b=!0),_helper.loop(this._foundParent,a,null,null,this,b)},cStorage.prototype.getValue=function(a){return a?_helper.decode(this._foundChild):this._foundChild},cStorage.prototype.getUid=function(a,b){if(!a)throw new Error("missing function params");var c=this._foundParent;void 0==b&&(b=!0);var d=!1,e=function(a){d?a>d&&(d=a):d=a},f=function(b,c,d){a==c&&"number"==typeof d&&e(d)};return _helper.loop(c,f,null,null,null,b),d||(d=0),d+1},cStorage.prototype.toString=function(a,b,c){return JSON.stringify(this.get(a,b,c))},cStorage.prototype.isEmpty=function(){var a=this._foundParent;return""==JSON.stringify(a).replace(/[{}\[\]]/g,"")?!0:!1},cStorage.prototype.isFound=function(){return this._isFound};var _helper={getStorage:function(a){var b=window.localStorage.getItem(a)||"{}",c={};try{return c=JSON.parse(b),"object"==typeof c?c:{}}catch(d){throw new Error("non well formed json string")}},encode:function(a){return a&&"string"==typeof a?encodeURIComponent(a):a},decode:function(a){return a&&"string"==typeof a?decodeURIComponent(a.replace(/\+/g," ")):a},getRootObjFromString:function(a,b){if(!a)return!1;var c=a;if(b){b=b.split(".");for(var d in b)c=c[b[d]]}return c},loop:function(a,b,c,d,e,f){var g;if("[object Object]"===Object.prototype.toString.call(a))g="object";else{if("[object Array]"!==Object.prototype.toString.call(a))return!1;g="array"}for(var h in a)if(a.hasOwnProperty(h)){if(b){var i=b(a,h,a[h]);i&&(a[h]=i)}if("object"==typeof a[h]&&f){var j=_helper.loop(a[h],b,c,d,null,f);if(j)return j}if(d)if("object"==g){if(c.key&&c.value&&h==c.key&&a[h]==c.value)return d(a,a[h])}else if("array"==g&&c.value&&a[h]==c.value)return d(a,a[h])}return e?e:!1}};